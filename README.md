# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание типов данных

Тип оплаты заказа

```
type TPayment = 'online' | 'cash';
```

Тип категории товара

```
type TCategory =
	| 'софт-скил'
	| 'хард-скил'
	| 'кнопка'
	| 'дополнительно'
	| 'другое';
```

Товар

```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: TCategory;
	price: number | null;
}
```

Заказ

```
interface IOrder {
	payment: TPayment;
	email: string;
	phone: string;
	address: string;
	total: number | null;
	items: string[];
}
```

Интерфейс модели данных товаров

```
interface IProductsData {
	items: IProduct[];
	preview: string | null;
}
```

Интерфейс модели данных корзины

```
interface IBasketData {
	items: TBasketProductInfo[];
	addItem(item: TBasketProductInfo): void;
	removeItem(id: string): void;
}
```

Данные товара, использующиеся в корзине товаров

```
type TBasketProductInfo = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Данные товара, используещиеся в галерее

```
export type TGalleryProductInfo = Omit<IProduct, 'description'>;
```

Данные заказа, использующиеся в корзине товаров

```
export type TOrderTotal = Pick<IOrder, 'items' | 'total'>;
```

Данные заказа, которые вводятся в модальном окне почты и типа оплаты

```
type TOrderDetails = Pick<IOrder, 'address' | 'payment'>;
```

Данные заказа, которые вводятся в модальном окне контактных данных

```
type TOrderContacts = Pick<IOrder, 'email' | 'phone'>;
```

## Архитектура приложения

Приложения написано согласно паттерну MVP, что подразумевает под собой разбитие его кода на три слоя:

- Слой данных (модель), отвечает за хранение и обработку данных,
- Слой представления, отвечает за отображение компонентов на странице,
- Презентер, отвечает за связь между данными и представлением.

### Базовый код

#### Класс Api

Отвечает за создание и отправку запросов на сервер.\
В конструктор класса передается базовый адрес сервера и необязательный объект с дополнительными заголовками.

Методы:

- `get` - принимает в качестве параметра эндпоинт, выполняет GET запрос и возвращает промис с объектом ответа сервера.
- `post` - принимает в качестве параметров эндпоинт, объект с данными, который будет преобразован в JSON формат и передан в теле запроса, метод (POST по умолчанию), выполняет запрос и возвращает промис с объектом ответа сервера.

#### Класс EventEmitter

Брокер событий, отвечает за генерацию, отправку и подписку на события.

Методы:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает коллбек, инициализирующий событие, переданное в параметре, при вызове

### Коммуникация

#### Класс AppApi

Принимает экземпляр класса `EventEmitter` и предоставляет методы для работы с серверной частью приложения.

### Слой данных

#### Класс ProductsData

Класс отвечает за хранение массива товаров и товара, выбранного для просмотра.\
В конструктор принимает экземпляр класса `EventEmitter`

Поля:

- `_items` - хранит массив объектов товаров
- `_preview` - хранит id товара, выбранного для просмотра
- `events` - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:

- геттеры и сеттеры для получения и установки полей класса

#### Класс BasketData

Класс отвечает за хранение и работу с данными товаров, помещенных в корзину товаров.\
В конструктор принимает экземпляр класса `EventEmitter`

Поля:

- `_items` - хранит массив объектов товаров корзины
- `events` - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:

- `addItem` - принимает в качестве параметра товар и добавляет его в корзину
- `removeItem` - принимает в качестве параметра id товара и удаляет из корзины товар с таким id
- геттер для получения поля класса

#### Класс OrderData

Класс отвечает за хранение и работу с данными заказа.\
В конструктор принимает экземпляр класса `EventEmitter`

Поля:

- `payment` - тип оплаты
- `email` - почта пользователя
- `phone` - телефон пользователя
- `address` - адрес доставки
- `total` - сумма заказа
- `items` - id товаров в заказе
- `events` - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:

- `getOrder` - возвращает полный объект заказа для отправки на сервер
- `setOrderTotal` - устанавливает сумму заказа и id товаров в заказе
- `setOrderDetails` - устанавливает тип оплаты и адрес доставки
- `setOrderContacts` - устанавливает почту и телефон пользователя

### Слой отображения

#### Класс Page

Класс служит для работы с главной страницей приложения.\
В конструктор принимает элемент главной страницы и экземпляр класса `EventEmitter` для инициации событий.

Поля:

- `page` - элемент главной страницы
- `basketButton` - элемент кнопки корзины
- `basketCounter` - элемент счетчика товаров корзины
- `_gallery` - элемент контейнера галереи товаров

Методы:

- `incCounter` - увеличивает значение счетчика на 1
- `decCounter` - уменьшает значение счетчика на 1
- сеттер для установки элемента галереи с карточками

#### Класс Form

Класс служит для создания разметки формы из соответствующего темплейта и взаимодействия с ней.\
В конструктор принимает темплейт формы и экземпляр класса `EventEmitter` для инициации событий.

Поля:

- `form` - элемент формы
- `submitButton` - элемент кнопки сабмита
- `inputs` - массив полей ввода формы
- `errors` - объект с name-атрибутом инпута в качестве ключа и
  элементом ошибки в качестве значения
- `events` - экземпляр класса `EventEmitter`

Методы:

- `render` - возвращает разметку формы
- `getInputValues` - возвращает объект с name-атрибутом инпута в качестве ключа и значение, которое ввёл пользователь
- `showInputError` - принимает в качестве параметров name-атрибут инпута, у которого необходимо отобразить ошибку и текст ошибки
- `hideInputError` - принимает в качестве параметров name-атрибут инпута, у которого необходимо скрыть ошибку

#### Класс Modal

Класс служит для работы с разметкой универсального модального окна.\
В конструктор принимает элемент модального окна и экземпляр класса `EventEmitter` для инициации событий.

Поля:

- `modal` - элемент модального окна
- `modalContent` - элемент контейнера модального окна для контента
- `events` - экземпляр класса `EventEmitter`

Методы:

- `render` - принимает в качестве параметра разметку, которую необходимо отобразить в модальном окне и возвращает разметку заполненного модального окна
- `open` - открывает модальное окно и вешает слушатели на закрытие
- `close` - закрывает модальное окно по нажатию Esc или клику на крестик/оверлей, снимает слушатели на закрытие и очищает отображаемый в нем контент

#### Класс Product

Класс служит для создания разметки карточки товара из соответствующего темплейта.\
В конструктор принимает темплейт карточки, соответствующий обработчик клика и экземпляр класса `EventEmitter` для инициации событий.\
В полях класса содержатся элементы разметки карточки и экземпляр класса `EventEmitter`.

Методы:

- `setData` - устанавливает значения элементам карточки товара
- `deleteCard` - метод для удаления разметки карточки
- `render` - возвращает разметку полностью заполненной карточки
- геттеры для получения полей класса

#### Класс ProductGallery

Класс служит для создания разметки галереи товаров из соответствующего темплейта.\
В конструктор принимает темплейт галереи и экземпляр класса `EventEmitter` для инициации событий.\

Поля:

- `_items` - массив созданных элементов карточек с товарами галереи
- `events` - экземпляр класса `EventEmitter`

Методы:

- сеттер для заполнения массива разметок карточек

#### Класс Basket

Класс служит для создания разметки корзины товаров из соответствующего темплейта.\
В конструктор принимает темплейт корзины товаров и экземпляр класса `EventEmitter` для инициации событий.

Поля:

- `basket` - элемент корзины товаров
- `basketList` - элемент списка товаров корзины
- `_items` - массив созданных элементов карточек с товарами корзины
- `events` - экземпляр класса `EventEmitter`

Методы:

- `render` - возвращает разметку корзины, заполненную товарами

#### Класс Success

Класс служит для создания разметки сообщения об успешном заказе из соответствующего темплейта.\
В конструктор принимает темплейт сообщения и экземпляр класса `EventEmitter` для инициации событий.

Поля:

- `_total` - элемент с информацией о сумме заказа
- `events` - экземпляр класса `EventEmitter`

Методы:

- `render` - возвращает разметку сообщения об успехе
- сеттер для установки значения суммы заказа

### Слой презентера

Презентер не имеет отдельного класса, код презентера, опизывающий взаимодействие между компонентами находится в файле `index.ts`

## Взаимодействие внутри приложения

Приложение использует событийно-ориентированный подход.\
Взаимодействие производится путем генерации событий с помощью брокера событий и обработки их в слушателях, описанный в файле `index.ts`.\

### Список всех генерируемых событий

#### События, генерируеммые в слое данных

- `products:changed` - список товаров изменен
- `product:selected` - товар, выбранный для просмотра, изменился
- `basketProducts:changed` - список товаров в корзине изменен
- `order:changed` - данные заказа изменены

#### События, генерируемые в слое отображения

- `product:select` - выбор товара для просмотра
- `product:clear` - необходима очистка товара для просмотра
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `basketProduct:add` - выбор товара для добавления в корзину
- `basketProduct:remove` - выбор товара для удаления из корзины
- `orderItems:change` - изменение списка товаров к заказу
- `payment:input` - событие выбора типа оплаты
- `address:input` - событие ввода данных внутри поля адреса заказа
- `adress:validation` - необходима валидация поля ввода адреса
- `orderDetails:submit` - событие, генерируемое при сабмите формы с типом оплаты и адреса доставки заказа
- `email:input` - событие ввода данных внутри поля почты заказа
- `email:validation` - необходима валидация поля ввода почты
- `phone:input` - событие ввода данных внутри поля номера телефона заказа
- `phone:validation` - необходима валидация поля ввода телефона
- `orderContacts:submit` - событие, генерируемое при сабмите формы с контактами заказа
